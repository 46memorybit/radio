<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover"
  />
  <title>リクエスト支援PWA</title>
  <meta name="theme-color" content="#0b1020" />
  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="apple-touch-icon" href="./assets/icon-192.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <style>
    :root { color-scheme: light dark; }
    * { box-sizing: border-box; }
    html, body {
      margin: 0;
      height: 100%;
      background:#0b1020;
      color:#e5e7eb;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif;
    }
    input, textarea, button, select { font-size:16px !important; }

    /* ===== レイアウト ===== */
    .copy-bar {
      position: fixed; inset: 0 0 auto 0; height: 20vh;
      background: linear-gradient(180deg, rgba(11,16,32,0.98), rgba(11,16,32,0.9));
      border-bottom: 1px solid rgba(255,255,255,0.08);
      z-index: 1000;
      padding: 8px 12px 10px;
      display: grid;
      grid-template-rows: auto 1fr;
      gap: 8px;
    }
    .copy-bar h1 {
      margin: 0; font-size: 14px; font-weight: 600; opacity: .9;
    }
    .title-pills {
      display: flex; gap: 8px; overflow-x: auto; padding-bottom: 4px;
      -webkit-overflow-scrolling: touch;
    }
    .pill {
      flex: 0 0 auto;
      padding: 8px 10px; border: 1px solid rgba(255,255,255,0.12);
      border-radius: 999px; background: rgba(255,255,255,0.06);
      cursor: pointer; user-select: none;
      transition: transform .06s ease;
      white-space: nowrap; max-width: 240px; text-overflow: ellipsis; overflow: hidden;
    }
    .pill:active { transform: scale(0.98); }

    .tabs {
      position: sticky; top: 20vh; z-index: 900;
      background: #0b1020; border-bottom: 1px solid rgba(255,255,255,0.1);
      display: flex; gap: 6px; padding: 8px 10px;
    }
    .tab-btn {
      padding: 8px 12px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06); cursor: pointer;
    }
    .tab-btn[aria-selected="true"] {
      background: rgba(99,102,241,0.18);
      border-color: rgba(99,102,241,0.5);
    }

    .page {
      padding-top: 20vh; /* フローティングと重ならない余白 */
      min-height: 100vh;
    }
    .section {
      display: none;
      height: 80vh; /* 指定どおり */
      padding: 10px;
    }
    .section.active { display: block; }

    /* 登録エリア：左右 50%（スマホでも） */
    .register-grid {
      height: 100%;
      display: grid;
      grid-template-columns: 1fr 1fr; /* スマホでも左右半分 */
      gap: 10px;
      overflow: hidden;
    }
    .card {
      height: 100%;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.04);
      border-radius: 16px;
      padding: 12px;
      display: flex; flex-direction: column; gap: 10px;
      overflow: hidden;
    }
    .card h2 { margin: 0; font-size: 15px; opacity: .9; }
    .row { display: grid; gap: 6px; }
    .row.two { grid-template-columns: 1fr auto; align-items: end; }
    .input, .textarea {
      width: 100%; border-radius: 12px; border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06); color: #e5e7eb; padding: 10px 12px;
      outline: none;
    }
    .textarea { height: 160px; resize: none; }
    .btn {
      padding: 10px 12px; border-radius: 10px; cursor: pointer;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(99,102,241,0.18); color: #fff;
    }
    .btn.ghost { background: rgba(255,255,255,0.06); }
    .list {
      flex: 1 1 auto; overflow: auto; border-top: 1px dashed rgba(255,255,255,0.12); padding-top: 8px;
    }
    .item {
      display: grid; grid-template-columns: 1fr auto; gap: 6px;
      align-items: center; padding: 8px; border: 1px solid rgba(255,255,255,0.1);
      background: rgba(255,255,255,0.03); border-radius: 12px; margin-bottom: 8px;
    }
    .item-url { word-break: break-all; opacity: .92; }
    .item-actions { display: flex; gap: 6px; }
    .icon-btn {
      border-radius: 10px; padding: 6px 8px; border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06); cursor: pointer;
    }

    /* リクエストエリア（上10%：操作 / 下90%：iframe） */
    .request-wrap {
      height: 100%; display: grid; grid-template-rows: 10% 90%; gap: 8px;
    }
    .request-controls {
      display: grid; grid-template-columns: 1fr 1fr; gap: 8px;
    }
    .request-controls .btn { width: 100%; height: 100%; }
    .frame-wrap {
      border: 1px solid rgba(255,255,255,0.12); border-radius: 16px; overflow: hidden;
      background: #000;
    }
    iframe { width: 100%; height: 100%; border: 0; }

    .toast {
      position: fixed; left: 50%; bottom: 16px; transform: translateX(-50%);
      background: rgba(30, 41, 59, 0.9); color: #fff; padding: 10px 12px; border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.14);
      z-index: 1100; display: none;
    }
  </style>
</head>
<body>
  <!-- 20% フローティング固定：タイトルをタップでコピー -->
  <div class="copy-bar" id="copyBar">
    <h1>上部：保存済みタイトル（タップでコピー）</h1>
    <div class="title-pills" id="titlePills" aria-live="polite"></div>
  </div>

  <!-- タブ（登録 / リクエスト） -->
  <div class="tabs" role="tablist">
    <button class="tab-btn" id="tabRegister" role="tab" aria-selected="true">登録エリア</button>
    <button class="tab-btn" id="tabRequest" role="tab" aria-selected="false">リクエストエリア</button>
  </div>

  <main class="page" id="pageRoot" aria-live="polite">
    <!-- 登録エリア（左右 50%：テキスト / リクエスト(=URL) コンテナ） -->
    <section class="section active" id="sectionRegister" aria-labelledby="tabRegister">
      <div class="register-grid">
        <!-- 左：テキストコンテナ -->
        <div class="card" id="textCard">
          <h2>テキストコンテナ（タイトル＋本文の登録）</h2>
          <div class="row">
            <label>タイトル</label>
            <input id="titleInput" class="input" placeholder="例）FMリクエスト用テンプレ" />
          </div>
          <div class="row">
            <label>本文</label>
            <textarea id="bodyInput" class="textarea" placeholder="ここに本文を入力"></textarea>
          </div>
          <div class="row two">
            <button id="saveTextBtn" class="btn">保存</button>
            <button id="clearTextBtn" class="btn ghost" type="button">クリア</button>
          </div>
          <div class="list" id="textList" aria-label="保存済みテキスト一覧"></div>
        </div>

        <!-- 右：リクエスト（URL）コンテナ -->
        <div class="card" id="urlCard">
          <h2>リクエストコンテナ（URL登録＆並べ替え）</h2>
          <div class="row two">
            <input id="urlInput" class="input" placeholder="https://..." />
            <button id="addUrlBtn" class="btn" type="button">追加</button>
          </div>
          <div class="list" id="urlList" aria-label="登録URL一覧"></div>
        </div>
      </div>
    </section>

    <!-- リクエストエリア（上10%ボタン／下90% iframe） -->
    <section class="section" id="sectionRequest" aria-labelledby="tabRequest">
      <div class="request-wrap">
        <div class="request-controls">
          <button id="prevBtn" class="btn">前へ</button>
          <button id="nextBtn" class="btn">次へ</button>
        </div>
        <div class="frame-wrap">
          <iframe id="viewer" sandbox="allow-same-origin allow-scripts allow-forms allow-popups"></iframe>
        </div>
      </div>
    </section>
  </main>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script type="module" src="./db.js"></script>
  <script type="module" src="./app.js"></script>
  <script>
    // SW登録
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js').catch(()=>{});
      });
    }
  </script>
</body>
</html>
